<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Hello, PubNub</title>
  <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.8.4.1.js"></script>
</head>
<body>
  <div>
    <input id="message-body" type="text" />
    <button onclick="buttonClick()">Send</button>
    <div id="messages"></div>
  </div>

  <script>
    const buttonClick = () => {
      var input = document.getElementById('message-body');
      publishMessage(input.value);
      input.value = '';
    };

    const showMessage = (msg) => {
      var message = document.createElement('div');
      message.innerText = msg;
      document.getElementById('messages').appendChild(message);
    };

    let pubnub;

    const setupPubNub = () => {
      pubnub = new PubNub({
        publishKey: 'pub-c-ed96ec13-d157-4f34-b26d-2beaf19bcc4d',
        subscribeKey: 'sub-c-6c4f8459-3f89-4587-9784-7afa883a224b',
        userId: 'myUniqueUserId',
      });

      const channel = pubnub.channel('hello_world');
      const subscription = channel.subscription();

      pubnub.addListener({
        status: (s) => {
          console.log('Status', s.category);
        },
      });

      subscription.onMessage = (messageEvent) => {
        showMessage(messageEvent.message.description);
      };

      subscription.subscribe();
    };

    window.onload = setupPubNub;

    const publishMessage = async (message) => {
      const publishPayload = {
        channel: 'hello_world',
        message: {
          title: 'greeting',
          description: message,
        },
      };
      await pubnub.publish(publishPayload);
    };
  </script>
</body>
</html>
